UPDATE `sip`.`t_sys_pagemsg` SET `SPAGECODE`='1500357504096', `SFIELDCODE`='T_RKGZP__S_GZPBH,T_RKGZP__S_GZPZT,$IFLINK<<SYS_STRCURUSER>>$IN:<<S_AUD_USER>>$<a name=\"SYS_SHPUT_SEL\" href=\"javascript:#;\" class=\"button blue\" onclick=\"sFlow_evet.audit(this);\"><span><div class=\'bttn_panel\'\r\nstyle=\'background-image:url(images/eve/edit.png);\'>审核</div></span></a>`<div name=\"SYS_SHPUT_SEL\">---</div>,T_DQEZGZP__S_GZNR,T_DQEZGZP__S_JZ,T_DQEZGZP__S_ZY,T_DQEZGZP__S_BZBM,T_RKGZP__S_BPDJ,T_RKGZP__S_ZDR,T_RKGZP__S_ZDSJ,T_RKGZP__S_SPJG,S_RUN_AGR,S_AUD_USER,I_ISOVER2', `SFIELDNAME`='工作票编号,工作票状态,审核,工作内容,机组,专业,班组,办票地点,制单人,制单时间,审票结果,流程参数,流程用户,是否结束', `SFIELDSIZE`='170,120,120,120,120,120,120,120,120,120,120,0,0,0', `SQUERYFIELD`=NULL, `SGLFIELD`='SYSCLASS:button green:add.png|SYSCLICK:insert()$新增,SYSCLASS:button red:del.png|SYSCLICK:deldata()$删除,SYSCLASS:button red:add.png|SYSCLICK:voids()$作废,SYSCLASS:button red:add.png|SYSCLICK:printdata()$打印,SYSCLASS:button red:add.png|SYSCLICK:lc(14)$联查,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditLog();$审批日志,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditProComp();$流程图,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.ancelProcess();$撤回,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.screening(\'<<SYS_STRCURUSER>>\');$筛选审核,SYSCLASS:button red:add.png|SYSCLICK:workTicketExport(\'1500357504096\')$典型工作票导出', `SPAGENAME`='热控工作票', `SPAGETYPE`='1', `SQERYCON`='T_RKGZP.S_DEL <>1 and \'<<bmid>>\' like concat(T_RKGZP.S_ZZ,\'%\')\r\n order by T_RKGZP.S_ID desc', `SDELCON`='T_RKGZP$S_ID=<<T_RKGZP__S_ID>>', `SHREFIELD`=NULL, `SQUERYTABLE`='T_RKGZP  left join  t_sys_flow_run on T_RKGZP.S_RUN_ID= t_sys_flow_run.S_RUN_ID\r\n', `SSIZE`='0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0', `SQLFIELD`='	\r\nT_RKGZP.S_GZPBH T_RKGZP__S_GZPBH,T_RKGZP.S_GZPZT T_RKGZP__S_GZPZT,T_RKGZP.S_BPDJ T_RKGZP__S_BPDJ,T_RKGZP.S_ID T_RKGZP__S_ID,T_RKGZP.S_ZZ T_RKGZP__S_ZZ,T_RKGZP.S_SPJG T_RKGZP__S_SPJG,T_RKGZP.S_ZDR T_RKGZP__S_ZDR,T_RKGZP.S_ZDSJ T_RKGZP__S_ZDSJ	\r\n ,T_RKGZP.S_GZNR T_DQEZGZP__S_GZNR,\r\n			T_RKGZP.S_ZJ T_DQEZGZP__S_JZ,\r\n			T_RKGZP.S_ZY T_DQEZGZP__S_ZY,\r\n			T_RKGZP.S_BZ T_DQEZGZP__S_BZ,\r\n			T_RKGZP.S_BZBM T_DQEZGZP__S_BZBM,\r\n			T_RKGZP.S_BPDJ T_DQEZGZP__S_BPDD\r\n ,concat(\"<div name=\'S_RUN_AGR\'>\",T_RKGZP.S_ID,\",\",ifnull(T_SYS_flow_run.S_RUN_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_FLOW_ID,\'\'),\",\",T_RKGZP.SYS_FLOW_VER,\",\",ifnull( t_sys_flow_run.S_NODE_CODE,\'\'),\"</div>\") S_RUN_AGR,\r\nif(t_sys_flow_run.S_AUD_USER is null,\'\',replace(t_sys_flow_run.S_AUD_USER,\',\',\'`\')) S_AUD_USER,\r\nconcat(\"<div name=\'sys_I_isover\'>\",ifnull( t_sys_flow_run.I_ISOVER,\'\'),\"</div>\") I_ISOVER2\r\n\r\n', `SEDITPAGE`='View?SPAGECODE=1505703509013&sys_bed=true&bmid=<<T_RKGZP__S_ZZ>>&S_ID=<<T_RKGZP__S_ID>>&sid=<<T_RKGZP__S_ID>>&sys_no_copy=T_RKGZP$S_ID,T_RKGZP$S_GZPZT,T_RKGZP$S_GZBZRY,T_RKGZP$S_RS,T_RKGZP$S_JHKSGZSJ,T_RKGZP$S_JHJSGZSJ,T_RKGZP$S_QF_GZPQFRQM,T_RKGZP$S_GZPQFRQM,T_RKGZP$S_QF_QFSJ,T_RKGZP$S_QF_XMGLYQM,T_RKGZP$S_QF_XMGLYBM,T_RKGZP$S_QF_XMGLYQMSJ,T_RKGZP$S_JS_JSSJ,T_RKGZP$S_JS_JSR,T_RKGZP$S_JSRBM,T_RKGZP$S_PZ_PZKSGZSJ,T_RKGZP$S_PZ_PZJSGZSJ,T_RKGZP$S_PZ_BZ,T_RKGZP$S_BZHBM,T_RKGZP$S_PZ_ZZ,T_RKGZP$S_ZZBM,T_RKGZP$S_PZ_ZZSJ,T_RKGZP$S_XK_XKKSGZSJ,T_RKGZP$S_XK_GZFZR,T_RKGZP$S_S_XKGZFZRBM,T_RKGZP$S_XK_FZRSJ,T_RKGZP$S_XK_GZXKR,T_RKGZP$S_GZXKRBM,T_RKGZP$S_XK_XKRSJ,T_RKGZP$S_FZRBG_XFZR,T_RKGZP$S_XFZRBM,T_RKGZP$S_FZRBG_BGSJ,T_RKGZP$S_GZFZR_GZPQFR,T_RKGZP$S_GZPQFRBM,T_RKGZP$S_BG_QFRQMSJ,T_RKGZP$S_FZRBG_XKR,T_RKGZP$S_FZRBG_XKRBM,T_RKGZP$S_BG_GZXKRQMSJ,T_RKGZP$S_FZRBG_ZZ,T_RKGZP$S_FZRBGZZBM,T_RKGZP$S_YQ_YQZ,T_RKGZP$S_YQ_XKR,T_RKGZP$S_YQ_XKRBM,T_RKGZP$S_YQ_XKRSJ,T_RKGZP$S_YQ_GZFZR,T_RKGZP$S_YQ_GZFZRBM,T_RKGZP$S_YQ_FZRSJ,T_RKGZP$S_YQ_ZZ,T_RKGZP$S_YQZZBM,T_RKGZP$S_YQ_ZZSJ,T_RKGZP$S_GZZJ_JXGZJD,T_RKGZP$S_GZZJ_GZZJSJ,T_RKGZP$S_GZZJ_GZFZR,T_RKGZP$S_GZZJGZFZRBM,T_RKGZP$S_GZZJ_GZXKR,T_RKGZP$S_GZZJGZXKRBM,T_RKGZP$S_GZZJ_XKRQZSJ,T_RKGZP$S_GZZJ_XMGLY,T_RKGZP$S_GZZJ_XMGLYBM,T_RKGZP$S_DJZF_ZFR,T_RKGZP$S_DJZFRBM,T_RKGZP$T_DJZF_DJZFSJ,T_RKGZP$T_DJZF_BZ,T_RKGZP$S_ZDR,T_RKGZP$S_ZDSJ,T_RKGZP$S_GZPBH,T_RKGZP$S_RUN_ID,T_RKGZP$SYS_FLOW_VER,T_RKGZP$S_SPJG,T_RKGZP$S_ZDRBM,T_RKGZP$S_CJRBM,T_RKGZP$S_ZHXGRBM,T_RKGZP$S_CJSJ,T_RKGZP$S_ZDSJ,T_RKGZP$S_CJR', `SCONID`='1500358313406', `SMOD`='', `STRANS`='0,View_TS_GZPZT,0,0,View_TS_JZ,T_ZY,T_BZ ,1504854931447,0,0,1500877162713,0,0,0', `SUSERID`='sip', `SISSPLIT`='1:50', `SISLAYOUT`=NULL, `SSQLCON`='0,0,0,0,0,0,0,0,0,0,0,0,0,0', `SJUMPPAGE`=NULL, `SELEMENTTYPE`='005007017008', `STREE`='', `SJSSCRIPT`='//双击事件	\r\n/** yltPub.DBL_1500357504096=function(_objChilds,_iRowIndex){	\r\nminiWin(\'标题\',\'\',\'url\',parent.parent.parent.iScreen_Width-50,parent.parent.parent.iScreen_Height-50,\'\',\'\');	\r\n} **/	\r\n/*\r\n2018-04-13 10:59:35 Mantra\r\n*/\r\ndocument.write(\"<script src=\'res/js/alertfField.js?v=\"+ Math.random()+\"\' charset=\\\"utf-8\\\"><\\/script>\"); \r\n</script>\r\n<style>\r\n    .td1_none{\r\n        display:none;\r\n    }\r\n    .td1end_none{\r\n        display:none;\r\n    }\r\n</style>\r\n<script>\r\nsFlow_evet.init(\"1505703509013\", \"<<bmid>>\");  // 初始化流程运行方法\r\nsFlow_evet.processOver();  // 判断流程是否结束\r\nvar bmid=\"<<bmid>>\";\r\n\r\nfunction insert(){\r\n    miniWin(\'热控工作票\',\'\',\"View?SPAGECODE=1505703509013&bmid=<<bmid>>\",2000,1400,\'\',\'\');\r\n}\r\nyltPub.DBL_1500357504096=function(_objChilds,_iRowIndex){	\r\n   var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n    objCheckChilds[_iRowIndex-1].checked=true;\r\n    sys_EditForm(2000,1800,\"detail\");\r\n}\r\n\r\nfunction sys_EditForm(width,height,flag){ //修改数据\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n    if(arrCurSelRow.length>0){\r\n		if(arrCurSelRow.length>1){\r\n			alert(\"最多只能选中一条记录进行修改！\");\r\n		}else{\r\n		    // 流程是否结束   ||   设置flag\r\n		    var strUrl=$(\"syseditvalue\" + arrCurSelRow[0].value).value+\"&bmid=<<bmid>>\";\r\n		    \r\n		    if(flag===\"detail\"&&(sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"1\"||sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"0\")){\r\n		        strUrl+=\"&NO_VIEW_FLOW_BTTN=yes&doview=\" + flag;\r\n		    }\r\n			miniWin(\'修改信息\',\'\',strUrl,2000,1800,\'\',\'\');\r\n		}\r\n	}else{\r\n		alert(\"请选择一条修改项 \");\r\n	}\r\n}\r\n\r\nfunction deldata(){ //删除数据\r\n    strComponents = getDataId();\r\n    var arr;\r\n    if(strComponents ===false)return;\r\n        if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行删除!\");\r\n        return;\r\n    }else{\r\n        var strComponents = sys_getCurSelCheckBox()[0].value;\r\n        var createUser = tb.rows[parseInt(strComponents)+1].cells[9].innerHTML;\r\n		arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n		var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n                \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n                var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n        var jdlx = subGetTx(returnUserBz,\"jdlx\");\r\n             \r\n                /*if (jdlx==\"3\"){\r\n                    \r\n                }else{\r\n                    if(LCSFYX==\"0\"){\r\n                        alert(\"此单据已经启动流程\");\r\n                        return false;\r\n                    }\r\n                }*/\r\n            //判断是否结束\r\n        if(LCSFYX==\"1\"){\r\n            alert(\"流程结束,不可删除单据\");\r\n            return false;\r\n        //判断流程是否启动\r\n        }else if(LCSFYX==\"0\"){\r\n            //判读流程是否撤回\r\n            if(jdlx!=\"3\"){\r\n                alert(\"流程已启动,不可删除单据\");\r\n                return false;\r\n            }\r\n        }\r\n        //判读是否事管理员\r\n        if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n            //判读是否是当前用户创建的单据\r\n            if(createUser!=\"<<SYS_STRCURUSER>>\" && createUser!=\"<<SYS_STRCURUSERNAME>>\"){\r\n                alert(\"此单据不是您创建的单据不可删除\");\r\n                return false;\r\n            }\r\n        }\r\n                \r\n        strComponents= \"\'\"+arr[0]+\"\'\";\r\n       \r\n    }\r\n	if(confirm(\"确定要删除所选数据吗?\")){\r\n    	getTx(\"comid=026&tablename=T_RKGZP&sid=\"+strComponents,\"docommand\");\r\n    	getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n    	window.location.reload();\r\n    }\r\n}\r\n\r\nfunction sys_CopyForm(_iWidth,_iHeight){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行复制！\");\r\n		else{\r\n			var strUrl=$(\"syseditvalue\"+arrCurSelRow[0].value).value+\"&sys_copy=true\";\r\n			miniWin(\'复制信息\',\'\',strUrl,2000,2000,\'\',\'\');\r\n			}\r\n	else\r\n		alert(\"请选择一条复制项！\");\r\n  }\r\nfunction voids(){ //作废数据\r\n    strComponents = getDataId();\r\n    if(strComponents ===false)return;\r\n    if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行作废!\");\r\n        return;\r\n    }\r\n    if(confirm(\"确定要作废所选数据吗?\")){\r\n        var nowtime =getNowFormatDate();\r\n        var nowuser=\'<<SYS_STRCURUSER>>\';\r\n        getTx(\"comid=042&time=\"+nowtime+\"&user=\"+nowuser+\"&sid=\"+strComponents,\"docommand\");\r\n        \r\n         var arr = sFlow_evet.S_RUN_AGR[sys_getCurSelCheckBox()[0].value].innerHTML.split(\",\");\r\n        getTx(\"comid=092&S_FLOW_ID=\"+arr[2]+\"&S_RUN_ID=\"+arr[1],\"docommand\");\r\n        \r\n        window.location.reload();\r\n    }\r\n}\r\n\r\nfunction printdata(){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行打印！\");\r\n		else{\r\n			var str=$(\"sysdelvalue\"+arrCurSelRow[0].value).value;\r\n			str = str.substring(str.indexOf(\"$\")+1,str.length);\r\n			window.open(\"printrk.v?\"+str);\r\n		\r\n			}\r\n	else\r\n		alert(\"请选择一条打印项！\");\r\n\r\n}\r\n', `SFORM`='', `SISCOLCHANGEROW`='', `STRSTYLE`='', `SDATADB`='', `SINVOKE`='', `S_JS`='' WHERE (`SPAGECODE`='1500357504096');
