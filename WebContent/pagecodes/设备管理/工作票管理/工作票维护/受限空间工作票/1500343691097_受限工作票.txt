UPDATE `sip`.`t_sys_pagemsg` SET `SPAGECODE`='1500343691097', `SFIELDCODE`='T_RLJXEZGZP__S_GZPBH,T_RLJXEZGZP__S_GZPZT,T_RLJXEZGZP__S_BPDD,$IFLINK<<SYS_STRCURUSER>>$IN:<<S_AUD_USER>>$<a name=\"SYS_SHPUT_SEL\" href=\"javascript:#;\" class=\"button blue\" onclick=\"sFlow_evet.audit(this);\"><span><div class=\'bttn_panel\'\r\nstyle=\'background-image:url(images/eve/edit.png);\'>审核</div></span></a>`<div name=\"SYS_SHPUT_SEL\">---</div>,T_RLJXEZGZP__S_SPJG,T_RLJXEZGZP__S_ZDJ,T_RLJXEZGZP__S_ZDSJ,S_RUN_AGR,S_AUD_USER,I_ISOVER2', `SFIELDNAME`='工作票编号,工作票状态,办票地点,审核,审票结果,制单人,制单时间,流程参数,流程用户,是否结束', `SFIELDSIZE`='170,120,120,120,120,120,1,0,0,0', `SQUERYFIELD`=NULL, `SGLFIELD`='SYSCLASS:button red:add.png|SYSCLICK:insert()$新增,SYSCLASS:button red:del.png|SYSCLICK:deldata()$删除,SYSCLASS:button red:add.png|SYSCLICK:voids()$作废,SYSCLASS:button red:add.png|SYSCLICK:printdata()$打印,SYSCLASS:button red:add.png|SYSCLICK:lc(13);$联查,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditLog();$审批日志,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditProComp();$流程图,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.ancelProcess();$撤回,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.screening(\'<<SYS_STRCURUSER>>\');$筛选审核', `SPAGENAME`='受限工作票', `SPAGETYPE`='1', `SQERYCON`='T_RLJXEZGZP.S_DEL<>1 and \'<<bmid>>\' like concat(T_RLJXEZGZP.S_ZZ,\'%\')\r\n order by T_RLJXEZGZP.S_ID desc', `SDELCON`='T_RLJXEZGZP$S_ID=<<T_RLJXEZGZP__S_ID>>', `SHREFIELD`=NULL, `SQUERYTABLE`='T_RLJXEZGZP left join  t_sys_flow_run on T_RLJXEZGZP.S_RUN_ID= t_sys_flow_run.S_RUN_ID\r\n', `SSIZE`='0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0', `SQLFIELD`='	\r\nT_RLJXEZGZP.S_GZPBH T_RLJXEZGZP__S_GZPBH,T_RLJXEZGZP.S_GZPZT T_RLJXEZGZP__S_GZPZT,T_RLJXEZGZP.S_BPDD T_RLJXEZGZP__S_BPDD,T_RLJXEZGZP.S_ID T_RLJXEZGZP__S_ID,T_RLJXEZGZP.S_ZZ T_RLJXEZGZP__S_ZZ,T_RLJXEZGZP.S_SPJG T_RLJXEZGZP__S_SPJG,T_RLJXEZGZP.S_ZDJ T_RLJXEZGZP__S_ZDJ,T_RLJXEZGZP.S_ZDSJ T_RLJXEZGZP__S_ZDSJ	\r\n ,concat(\"<div name=\'S_RUN_AGR\'>\",T_RLJXEZGZP.S_ID,\",\",ifnull(T_SYS_flow_run.S_RUN_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_FLOW_ID,\'\'),\",\",T_RLJXEZGZP.SYS_FLOW_VER,\",\",ifnull( t_sys_flow_run.S_NODE_CODE,\'\'),\"</div>\") S_RUN_AGR,\r\nif(t_sys_flow_run.S_AUD_USER is null,\'\',replace(t_sys_flow_run.S_AUD_USER,\',\',\'`\')) S_AUD_USER,\r\nconcat(\"<div name=\'sys_I_isover\'>\",ifnull( t_sys_flow_run.I_ISOVER,\'\'),\"</div>\") I_ISOVER2\r\n', `SEDITPAGE`='View?SPAGECODE=1505729336281&sys_bed=true&bmid=<<T_RLJXEZGZP__S_ZZ>>&S_ID=<<T_RLJXEZGZP__S_ID>>&sid=<<T_RLJXEZGZP__S_ID>>&sys_no_copy=T_RLJXEZGZP$S_GZPZT,T_RLJXEZGZP$S_JHKSGZSJ,T_RLJXEZGZP$S_JHJSGZSJ,T_RLJXEZGZP$S_QF_GZPQFRQM,T_RLJXEZGZP$S_GZPQFRQMBM,T_RLJXEZGZP$S_QF_QFSJ,T_RLJXEZGZP$S_XK_XKKSGZSJ,T_RLJXEZGZP$S_XK_GZXKR,T_RLJXEZGZP$S_GZXKRBM,T_RLJXEZGZP$S_XK_GZFZR,T_RLJXEZGZP$S_XKGZFZRBM,T_RLJXEZGZP$S_FZRBG_XFZR,T_RLJXEZGZP$S_XFZRBM,T_RLJXEZGZP$S_FZRBG_BGSJ,T_RLJXEZGZP$S_FZRBG_GZPQFRQM,T_RLJXEZGZP$S_BGGZPQBM,T_RLJXEZGZP$S_FZRBG_GZPQFRSPSJ,T_RLJXEZGZP$S_FZRBG_XFZRQM,T_RLJXEZGZP$S_XFZRQMBM,T_RLJXEZGZP$S_FZRBG_GZXKRQM,T_RLJXEZGZP$S_BGXKRQM,T_RLJXEZGZP$S_GZZJ_GZZJSJ,T_RLJXEZGZP$S_GZZJ_XMGLY,T_RLJXEZGZP$S_ZJXMGLYBM,T_RLJXEZGZP$S_GZZJ_GZFZR,T_RLJXEZGZP$S_ZJFZRBM,T_RLJXEZGZP$S_GZZJ_GZXKR,T_RLJXEZGZP$S_ZJXKRBM,T_RLJXEZGZP$S_GZZJ_XKRQZSJ,T_RLJXEZGZP$S_GZZJ_JXGZJD,T_RLJXEZGZP$S_DJZF_ZFR,T_RLJXEZGZP$S_DJZF_DJZFSJ,T_RLJXEZGZP$S_DJZF_BZ,T_RLJXEZGZP$S_ZDJ,T_RLJXEZGZP$S_ZDRBM,T_RLJXEZGZP$S_ZDSJ,T_RLJXEZGZP$S_ID,T_RLJXEZGZP$S_GZPBH,T_RLJXEZGZP$S_RUN_ID,T_RLJXEZGZP$S_SPJG', `SCONID`='1500344833650', `SMOD`='', `STRANS`='0,View_TS_GZPZT,1504854931447,0,1500877162713,0,0,0,0,0', `SUSERID`='sip', `SISSPLIT`='1:50', `SISLAYOUT`=NULL, `SSQLCON`='0,0,0,0,0,0,0,0,0,0', `SJUMPPAGE`=NULL, `SELEMENTTYPE`='005007017004', `STREE`='', `SJSSCRIPT`='//双击事件	\r\n/** yltPub.DBL_1500343691097=function(_objChilds,_iRowIndex){	\r\nminiWin(\'标题\',\'\',\'url\',parent.parent.parent.iScreen_Width-50,parent.parent.parent.iScreen_Height-50,\'\',\'\');	\r\n} **/	\r\n/*\r\n2018-04-13 10:34:15 Mantra\r\n*/\r\ndocument.write(\"<script src=\'res/js/alertfField.js?v=\"+ Math.random()+\"\' charset=\\\"utf-8\\\"><\\/script>\"); \r\n</script>\r\n<style>\r\n    .td1_none{\r\n        display:none;\r\n    }\r\n    .td1end_none{\r\n        display:none;\r\n    }\r\n</style>\r\n<script>\r\nsFlow_evet.init(\"1505729336281\", \"<<bmid>>\");  // 初始化流程运行方法\r\nsFlow_evet.processOver();  // 判断流程是否结束\r\nvar bmid=\"<<bmid>>\";\r\n\r\nfunction insert(){\r\n    miniWin(\'受限空间工作票\',\'\',\"View?SPAGECODE=1505729336281&bmid=<<bmid>>\",2000,1400,\'\',\'\');\r\n		\r\n}\r\nyltPub.DBL_1500343691097=function(_objChilds,_iRowIndex){	\r\n   var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n    objCheckChilds[_iRowIndex-1].checked=true;\r\n    sys_EditForm(2000,1800,\"detail\");\r\n}\r\nfunction sys_CopyForm(_iWidth,_iHeight){ //复制数据\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行复制！\");\r\n		else{\r\n			var strUrl=$(\"syseditvalue\"+arrCurSelRow[0].value).value+\"&sys_copy=true\";\r\n			miniWin(\'复制信息\',\'\',strUrl,2000,2000,\'\',\'\');\r\n			}\r\n	else\r\n		alert(\"请选择一条复制项！\");\r\n  }\r\n\r\nfunction sys_EditForm(width,height,flag){ //修改数据\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n    if(arrCurSelRow.length>0){\r\n		if(arrCurSelRow.length>1){\r\n			alert(\"最多只能选中一条记录进行修改！\");\r\n		}else{\r\n		    // 流程是否结束   ||   设置flag\r\n		    var strUrl=$(\"syseditvalue\" + arrCurSelRow[0].value).value+\"&bmid=<<bmid>>\";\r\n		    \r\n		   if(flag===\"detail\"&&(sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"1\"||sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"0\")){\r\n		        strUrl+=\"&NO_VIEW_FLOW_BTTN=yes&doview=\" + flag;\r\n		    }\r\n			miniWin(\'修改信息\',\'\',strUrl,2000,1800,\'\',\'\');\r\n		}\r\n	}else{\r\n		alert(\"请选择一条修改项 \");\r\n	}\r\n}\r\n\r\nfunction deldata(){ //删除数据\r\n    strComponents = getDataId();\r\n    var arr;\r\n    if(strComponents ===false)return;\r\n        if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行删除!\");\r\n        return;\r\n    }else{\r\n        var strComponents = sys_getCurSelCheckBox()[0].value;\r\n		arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n		var createUser = tb.rows[parseInt(strComponents)+1].cells[6].innerHTML;\r\n		var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n                \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n                var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n       var jdlx = subGetTx(returnUserBz,\"jdlx\");\r\n             \r\n                /*if (jdlx==\"3\"){\r\n                    \r\n                }else{\r\n                    if(LCSFYX==\"0\"){\r\n                        alert(\"此单据已经启动流程\");\r\n                        return false;\r\n                    }\r\n                }*/\r\n        //判断是否结束\r\n        if(LCSFYX==\"1\"){\r\n            alert(\"流程结束,不可删除单据\");\r\n            return false;\r\n        //判断流程是否启动\r\n        }else if(LCSFYX==\"0\"){\r\n            //判读流程是否撤回\r\n            if(jdlx!=\"3\"){\r\n                alert(\"流程已启动,不可删除单据\");\r\n                return false;\r\n            }\r\n        }\r\n        //判读是否事管理员\r\n        if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n            //判读是否是当前用户创建的单据\r\n            if(createUser!=\"<<SYS_STRCURUSER>>\" && createUser!=\"<<SYS_STRCURUSERNAME>>\"){\r\n                alert(\"此单据不是您创建的单据不可删除\");\r\n                return false;\r\n            }\r\n        }\r\n        strComponents= \"\'\"+arr[0]+\"\'\";\r\n       \r\n    }\r\n	if(confirm(\"确定要删除所选数据吗?\")){\r\n    	getTx(\"comid=026&tablename=T_RLJXEZGZP&sid=\"+strComponents,\"docommand\");\r\n    getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n    	window.location.reload();\r\n    }\r\n}\r\n\r\nfunction voids(){ //作废数据\r\n    strComponents = getDataId();\r\n    if(strComponents ===false)return;\r\n    if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行作废!\");\r\n        return;\r\n    }\r\n    if(confirm(\"确定要作废所选数据吗?\")){\r\n        var nowtime =getNowFormatDate();\r\n        var nowuser=\'<<SYS_STRCURUSER>>\';\r\n        getTx(\"comid=039&time=\"+nowtime+\"&user=\"+nowuser+\"&sid=\"+strComponents,\"docommand\");    \r\n        \r\n        var arr = sFlow_evet.S_RUN_AGR[sys_getCurSelCheckBox()[0].value].innerHTML.split(\",\");\r\n        getTx(\"comid=092&S_FLOW_ID=\"+arr[2]+\"&S_RUN_ID=\"+arr[1],\"docommand\");\r\n        \r\n        window.location.reload();\r\n    }\r\n}\r\n	\r\n	\r\nfunction printdata(){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行打印！\");\r\n		else{\r\n			var str=$(\"sysdelvalue\"+arrCurSelRow[0].value).value;\r\n			str = str.substring(str.indexOf(\"$\")+1,str.length);\r\n			window.open(\"printrljxez.v?\"+str);\r\n		\r\n			}\r\n	else\r\n		alert(\"请选择一条打印项！\");\r\n\r\n}\r\n', `SFORM`='', `SISCOLCHANGEROW`='', `STRSTYLE`='', `SDATADB`='', `SINVOKE`='', `S_JS`='' WHERE (`SPAGECODE`='1500343691097');
