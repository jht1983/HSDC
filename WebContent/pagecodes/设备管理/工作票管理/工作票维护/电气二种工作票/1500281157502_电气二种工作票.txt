UPDATE `sip`.`t_sys_pagemsg` SET `SPAGECODE`='1500281157502', `SFIELDCODE`='T_DQEZGZP__S_GZPBH,T_DQEZGZP__S_GZPZT,$IFLINK<<SYS_STRCURUSER>>$IN:<<S_AUD_USER>>$<a  name=\"SYS_SHPUT_SEL\" href=\"javascript:#;\"class=\"button blue\" onclick=\"sFlow_evet.audit(this);\"><span><div class=\'bttn_panel\'\r\nstyle=\'background-image:url(images/eve/edit.png);\'>审核</div></span></a>`<div name=\"SYS_SHPUT_SEL\">---</div>,T_DQEZGZP__S_GZNR,T_DQEZGZP__S_JZ,T_DQEZGZP__S_ZY,T_DQEZGZP__S_BZBM,T_DQEZGZP__S_SBMC,T_DQEZGZP__S_BPDD,T_DQEZGZP__S_ZDR,T_DQEZGZP__S_ZDSJ,T_DQEZGZP__S_SPJG,S_RUN_AGR,S_AUD_USER,I_ISOVER2', `SFIELDNAME`='工作票编号,工作票状态,审核,工作内容,机组,专业,班组,设备名称,办票地点,制单人,制单时间,审票结果,流程参数,流程用户,是否结束', `SFIELDSIZE`='170,120,120,120,120,120,120,120,120,120,120,120,0,0,0', `SQUERYFIELD`=NULL, `SGLFIELD`='SYSCLASS:button red:add.png|SYSCLICK:insert()$新增,SYSCLASS:button red:del.png|SYSCLICK:delSysAll()$删除,SYSCLASS:button red:add.png|SYSCLICK:voids()$作废,SYSCLASS:button red:add.png|SYSCLICK:printdata()$打印,SYSCLASS:button red:add.png|SYSCLICK:lc(11)$联查,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditLog();$审批日志,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditProComp();$流程图,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.ancelProcess();$撤回,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.screening(\'<<SYS_STRCURUSER>>\');$筛选审核,SYSCLASS:button red:add.png|SYSCLICK:workTicketExport(\'1500281157502\')$典型工作票导出', `SPAGENAME`='电气二种工作票', `SPAGETYPE`='1', `SQERYCON`='T_DQEZGZP.S_DEL<>1  and T_DQEZGZP.S_ZZ=\'<<bmid>>\'\r\n order by T_DQEZGZP.S_ID desc', `SDELCON`='T_DQEZGZP$S_ID=<<T_DQEZGZP__S_ID>>', `SHREFIELD`=NULL, `SQUERYTABLE`='T_DQEZGZP left join  t_sys_flow_run on T_DQEZGZP.S_RUN_ID= t_sys_flow_run.S_RUN_ID\r\n', `SSIZE`='0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0', `SQLFIELD`='	\r\nT_DQEZGZP.S_GZPBH T_DQEZGZP__S_GZPBH,T_DQEZGZP.S_GZPZT T_DQEZGZP__S_GZPZT,T_DQEZGZP.S_ZZ T_DQEZGZP__S_ZZ,T_DQEZGZP.S_ID T_DQEZGZP__S_ID,T_DQEZGZP.S_SPJG T_DQEZGZP__S_SPJG,T_DQEZGZP.S_ZDR T_DQEZGZP__S_ZDR,T_DQEZGZP.S_ZDSJ T_DQEZGZP__S_ZDSJ	\r\n,T_DQEZGZP.S_GZNR T_DQEZGZP__S_GZNR,\r\n			T_DQEZGZP.S_JZ T_DQEZGZP__S_JZ,\r\n			T_DQEZGZP.S_ZY T_DQEZGZP__S_ZY,\r\n			T_DQEZGZP.S_BZ T_DQEZGZP__S_BZ,\r\n			T_DQEZGZP.S_BZBM T_DQEZGZP__S_BZBM,\r\n			T_DQEZGZP.S_SBMC T_DQEZGZP__S_SBMC,\r\n			T_DQEZGZP.S_BPDD T_DQEZGZP__S_BPDD\r\n,concat(\"<div name=\'S_RUN_AGR\'>\",T_DQEZGZP.S_ID,\",\",ifnull(T_SYS_flow_run.S_RUN_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_FLOW_ID,\'\'),\",\",T_DQEZGZP.SYS_FLOW_VER,\",\",ifnull( t_sys_flow_run.S_NODE_CODE,\'\'),\"</div>\") S_RUN_AGR,\r\nif(t_sys_flow_run.S_AUD_USER is null,\'\',replace(t_sys_flow_run.S_AUD_USER,\',\',\'`\')) S_AUD_USER,\r\nconcat(\"<div name=\'sys_I_isover\'>\",ifnull( t_sys_flow_run.I_ISOVER,\'\'),\"</div>\") I_ISOVER2\r\n\r\n', `SEDITPAGE`='View?SPAGECODE=1505700684880&sys_bed=true&bmid=<<T_DQEZGZP__S_ZZ>>&S_ID=<<T_DQEZGZP__S_ID>>&sid=<<T_DQEZGZP__S_ID>>&sys_no_copy=T_DQEZGZP$S_ID,T_DQEZGZP$S_GZPZT,T_DQEZGZP$S_JHKSGZSJ,T_DQEZGZP$S_JHJSGZSJ,T_DQEZGZP$S_QF_GZPQFRQM,T_DQEZGZP$S_GZPQFRQMBM,T_DQEZGZP$S_QF_GZPQFRSPSJ,T_DQEZGZP$S_QF_SMGLYQM,T_DQEZGZP$S_XMGLYBM,T_DQEZGZP$S_QF_XMGLYSJ,T_DQEZGZP$S_JS_JSSJ,T_DQEZGZP$S_JS_JSR,T_DQEZGZP$S_JSRBM,T_DQEZGZP$S_PZ_PZKSGZSJ,T_DQEZGZP$S_PZ_PZJSGZSJ,T_DQEZGZP$S_PZ_ZZ,T_DQEZGZP$S_ZZBM,T_DQEZGZP$S_PZ_ZZPZSJ,T_DQEZGZP$S_XK_XKKSGZSJ,T_DQEZGZP$S_XK_GZXKRQM,T_DQEZGZP$S_XKGZXKRQMBM,T_DQEZGZP$S_XK_XKRQZSJ,T_DQEZGZP$S_XK_GZFZRQM,T_DQEZGZP$S_XKGZFZRQMBM,T_DQEZGZP$S_XK_GZBZCYQM,T_DQEZGZP$S_XKGZBZCYQMBM,T_DQEZGZP$S_BG_GZPQFR,T_DQEZGZP$S_BG_GZPQFRBM,T_DQEZGZP$S_BG_GZPQFRSJ,T_DQEZGZP$S_BG_XKRQM,T_DQEZGZP$S_BG_XKRQMBM,T_DQEZGZP$S_BG_XKRQMSJ,T_DQEZGZP$S_BG_XGZFZR,T_DQEZGZP$S_BG_XGZFZRBM,T_DQEZGZP$S_BG_BGXFZR,T_DQEZGZP$S_BG_BGXFZRBM,T_DQEZGZP$S_YQ_YQZ,T_DQEZGZP$S_YQ_GZFZRQM,T_DQEZGZP$S_YQGZFUZRBM,T_DQEZGZP$S_YQ_GZFZRSPSJ,T_DQEZGZP$S_GZXKRQM,T_DQEZGZP$S_YQGZXKRBM,T_DQEZGZP$S_YQ_GZXKRSPSJ,T_DQEZGZP$S_YQ_ZBFZR,T_DQEZGZP$S_YQ_BZPZBM,T_DQEZGZP$S_YQ_ZBFZRSJ,T_DQEZGZP$S_GZZJ_GZZJSJ,T_DQEZGZP$S_GZZJ_GZFZRQM,T_DQEZGZP$S_GZZJGZFZRBM,T_DQEZGZP$S_GZZJ_FZRQMSJ,T_DQEZGZP$S_GZZJ_XMGLYQM,T_DQEZGZP$S_GZZJXMGLYBM,T_DQEZGZP$S_GZZJ_GZXKRQM,T_DQEZGZP$S_GZZJGZXKRBM,T_DQEZGZP$S_GZZJ_XKRQMSJ,T_DQEZGZP$S_GZZJ_JXGZJD,T_DQEZGZP$S_DJZF_ZFR,T_DQEZGZP$S_ZFRBM,T_DQEZGZP$S_DJZF_DJZFSJ,T_DQEZGZP$S_DJZF_BZ,T_DQEZGZP$S_ZDR,T_DQEZGZP$S_ZDSJ,T_DQEZGZP$S_ZDRBM,T_DQEZGZP$S_GZPBH,T_DQEZGZP$S_RUN_ID,T_DQEZGZP$S_SPJG', `SCONID`='1500281216032', `SMOD`='', `STRANS`='0,View_TS_GZPZT,0,0,View_TS_JZ,T_ZY,T_BZ ,0,1504854931447,0,0,1500877162713,0,0,0', `SUSERID`='SIP', `SISSPLIT`='1:50', `SISLAYOUT`=NULL, `SSQLCON`='0,0,0,0,0,0,0,0,0,0,0,0,0,0,0', `SJUMPPAGE`=NULL, `SELEMENTTYPE`='005007017002', `STREE`='', `SJSSCRIPT`='//双击事件	\r\n/** yltPub.DBL_1500281157502=function(_objChilds,_iRowIndex){	\r\nminiWin(\'标题\',\'\',\'url\',parent.parent.parent.iScreen_Width-50,parent.parent.parent.iScreen_Height-50,\'\',\'\');	\r\n} \r\nvar bac=\'<<sys_bed>>\';\r\nif(bac!=\'true\'){\r\n    document.getElementById(\'T_DQEZGZP$S_JHKSGZSJ\').value=\"\";\r\n    document.getElementById(\'T_DQEZGZP$S_JHJSGZSJ\').value=\"\";\r\n    }\r\n\r\n/*\r\n2018-04-13 09:43:12 Mantra\r\n*/\r\ndocument.write(\"<script src=\'res/js/alertfField.js?v=\"+ Math.random()+\"\' charset=\\\"utf-8\\\"><\\/script>\"); \r\n</script>\r\n<style>\r\n    .td1_none{\r\n        display:none;\r\n    }\r\n    .td1end_none{\r\n        display:none;\r\n    }\r\n</style>\r\n<script>\r\nsFlow_evet.init(\"1505700684880\", \"<<bmid>>\");  // 初始化流程运行方法\r\nsFlow_evet.processOver();  // 判断流程是否结束\r\nvar bmid=\"<<bmid>>\";\r\nyltPub.DBL_1500281157502=function(_objChilds,_iRowIndex){	\r\n    var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n    objCheckChilds[_iRowIndex-1].checked=true;\r\n    sys_EditForm(2000,1800,\"detail\");\r\n}\r\n\r\nfunction insert(){\r\n    miniWin(\'电气二种工作票\',\'\',\"View?SPAGECODE=1505700684880&bmid=<<bmid>>\",2000,1400,\'\',\'\');\r\n}\r\n\r\nfunction sys_EditForm(width,height,flag){ //修改数据\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n    if(arrCurSelRow.length>0){\r\n		if(arrCurSelRow.length>1){\r\n			alert(\"最多只能选中一条记录进行修改！\");\r\n		}else{\r\n		    // 流程是否结束   ||   设置flag\r\n		    var strUrl=$(\"syseditvalue\" + arrCurSelRow[0].value).value+\"&bmid=<<bmid>>\";\r\n		    \r\n		    if(flag===\"detail\"&&(sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"1\"||sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"0\")){\r\n		        strUrl+=\"&doview=\" + flag;\r\n		    }\r\n			miniWin(\'修改信息\',\'\',strUrl,2000,1800,\'\',\'\');\r\n		}\r\n	}else{\r\n		alert(\"请选择一条修改项 \");\r\n	}\r\n}\r\n  \r\nfunction delSysAll(){\r\n      var arrCurSelRow=sys_getCurSelCheckBox();\r\n      if(arrCurSelRow.length>0){\r\n          if(arrCurSelRow.length>1){\r\n              alert(\"最多只能选中一条记录进行删除！\");\r\n          }else{\r\n            var strComponents = arrCurSelRow[0].value;\r\n            var createUser = tb.rows[parseInt(strComponents)+1].cells[10].innerHTML;\r\n            var arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n            var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n              \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n            var CJR = subGetTx(returnUserBz,\"S_LAUNCH_USER\");\r\n            var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n            var jdlx = subGetTx(returnUserBz,\"jdlx\");\r\n            console.log(createUser);\r\n            console.log(returnUserBz);\r\n            var processIndex = subGetTx(returnUserBz,\"processIndex\");\r\n    		//判断是否结束\r\n            if(LCSFYX==\"1\"){\r\n                alert(\"流程结束,不可删除单据\");\r\n                return false;\r\n            //判断流程是否启动\r\n            }else if(LCSFYX==\"0\"){\r\n                //判读流程是否撤回\r\n                if(jdlx!=\"3\"){\r\n                    alert(\"流程已启动,不可删除单据\");\r\n                    return false;\r\n                }\r\n            }\r\n            //判读是否事管理员\r\n            if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n                //判读是否是当前用户创建的单据\r\n                if(createUser!=\"<<SYS_STRCURUSER>>\" && createUser!=\"<<SYS_STRCURUSERNAME>>\"){\r\n                    alert(\"此单据不是您创建的单据不可删除\");\r\n                    return false;\r\n                }\r\n            }\r\n    		var message = \"确定要删除所选数据吗？\";\r\n                if(processIndex==\"\"){\r\n                message=\"此单据未启动流程,\"+message;\r\n            }\r\n              if(confirm(message)){\r\n                    var strDelParam=\"\";\r\n            		strDelParam=$(\"sysdelvalue\"+strComponents).value;\r\n            		getTx(strDelParam,\"YLDel\");\r\n            		try{\r\n            			getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n            		}catch(e){\r\n            			console.log(\"err:015->delSysAll\");\r\n            		}\r\n            		if(strDelParam.indexOf(\"NO_flush=true\")!=-1)\r\n            			parent.lxleft.yltTree.prototype.fushTree(\'testtree0\');\r\n            		location.reload();\r\n              }\r\n          }\r\n      }else{\r\n          alert(\"请选择一条删除项 \");\r\n      }\r\n}\r\n  \r\nfunction xiugai(){\r\n    var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n	var strComponents=\"\";\r\n	var objTable=document.getElementById(\"tb\");\r\n		var iCheckCount=objCheckChilds.length;\r\n		var count =0;\r\n		for(var i=0;i<iCheckCount;i++){\r\n			if(objCheckChilds[i].checked){\r\n				strComponents=objTable.rows[parseInt(objCheckChilds[i].value)+1].cells[12].innerHTML;\r\n				count++;\r\n			}\r\n		}\r\n		if(strComponents==\"\"||count>1){\r\n		    alert(\"请选择一行数据\");\r\n		}else{\r\n		     miniWin(\'修改\',\'\',\'View?SPAGECODE=1505700684880&sys_bed=true&bmid=<<bmid>>&S_ID=\'+strComponents,2000,1000,\'\',\'\');\r\n		}\r\n}\r\n\r\n\r\n\r\nfunction voids(){ //作废数据\r\n    strComponents = getDataId();\r\n    if(strComponents ===false)return;\r\n    if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行作废!\");\r\n        return;\r\n    }\r\n    if(confirm(\"确定要作废所选数据吗?\")){\r\n        var nowtime =getNowFormatDate();\r\n        var nowuser=\'<<SYS_STRCURUSER>>\';\r\n        getTx(\"comid=037&time=\"+nowtime+\"&user=\"+nowuser+\"&sid=\"+strComponents,\"docommand\");\r\n     \r\n        var arr = sFlow_evet.S_RUN_AGR[sys_getCurSelCheckBox()[0].value].innerHTML.split(\",\");\r\n        getTx(\"comid=092&S_FLOW_ID=\"+arr[2]+\"&S_RUN_ID=\"+arr[1],\"docommand\");\r\n     \r\n        window.location.reload();\r\n    }\r\n}\r\n	\r\nfunction sys_CopyForm(_iWidth,_iHeight){ //复制数据\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行复制！\");\r\n		else{\r\n			var strUrl=$(\"syseditvalue\"+arrCurSelRow[0].value).value+\"&sys_copy=true\";\r\n			miniWin(\'复制信息\',\'\',strUrl,2000,2000,\'\',\'\');\r\n			}\r\n	else\r\n		alert(\"请选择一条复制项！\");\r\n  }\r\nfunction printdata(){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行打印！\");\r\n		else{\r\n			var str=$(\"sysdelvalue\"+arrCurSelRow[0].value).value;\r\n			str = str.substring(str.indexOf(\"$\")+1,str.length);\r\n			window.open(\"printdqez.v?\"+str);\r\n		\r\n			}\r\n	else\r\n		alert(\"请选择一条打印项！\");\r\n\r\n}\r\n', `SFORM`='', `SISCOLCHANGEROW`='', `STRSTYLE`='', `SDATADB`='', `SINVOKE`='', `S_JS`='' WHERE (`SPAGECODE`='1500281157502');
