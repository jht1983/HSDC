UPDATE `sip`.`t_sys_pagemsg` SET `SPAGECODE`='1500260362709', `SFIELDCODE`='T_DQYZGZP__S_GZPBH,T_DQYZGZP__S_GZPZT,$IFLINK<<SYS_STRCURUSER>>$IN:<<S_AUD_USER>>$<a name=\"SYS_SHPUT_SEL\" href=\"javascript:#;\" class=\"button blue\" onclick=\"sFlow_evet.audit(this);\"><span><div class=\'bttn_panel\'\r\nstyle=\'background-image:url(images/eve/edit.png);\'>审核</div></span></a>`<div name=\"SYS_SHPUT_SEL\">---</div>,T_DQYZGZP__S_GZNR,T_DQYZGZP__S_JZ,T_DQYZGZP__S_ZY,T_DQYZGZP__S_BZRY,T_DQYZGZP__S_BPDD,T_DQYZGZP__S_GZXKRQM,T_DQYZGZP__S_ZDR,T_DQYZGZP__S_ZDSJ,T_DQYZGZP__S_SPJG,S_RUN_AGR,S_AUD_USER,I_ISOVER2', `SFIELDNAME`='工作票编号,工作票状态,审核,工作内容,机组,专业,班组,办票地点,许可人,制单人,制单时间,审票结果,流程参数,审核用户,是否结束', `SFIELDSIZE`='320,100,120,120,120,120,120,80,120,120,200,120,0,0,0', `SQUERYFIELD`=NULL, `SGLFIELD`='SYSCLASS:button green:add.png|SYSCLICK:insert()$新增,SYSCLASS:button red:del.png|SYSCLICK:deldata()$删除,SYSCLASS:button red:add.png|SYSCLICK:voids()$作废,SYSCLASS:button red:add.png|SYSCLICK:printdata()$打印,SYSCLASS:button red:add.png|SYSCLICK:lc(15)$联查,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditLog()$审批日志,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditProComp()$流程图,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.ancelProcess();$撤回,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.screening(\'<<SYS_STRCURUSER>>\');$筛选审核	', `SPAGENAME`='电气一种工作票', `SPAGETYPE`='1', `SQERYCON`='T_DQYZGZP.S_DEL<>1 and T_DQYZGZP.S_ZZ like concat(\'<<bmid>>\',\'%\')\r\n order by T_DQYZGZP.S_ID desc', `SDELCON`='T_DQYZGZP$S_ID=<<T_DQYZGZP__S_ID>>', `SHREFIELD`=NULL, `SQUERYTABLE`='T_DQYZGZP left join  t_sys_flow_run on T_DQYZGZP.S_RUN_ID= t_sys_flow_run.S_RUN_ID\r\n', `SSIZE`='0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0', `SQLFIELD`='	\r\nT_DQYZGZP.S_ZZ T_DQYZGZP__S_ZZ,T_DQYZGZP.S_GZPZT T_DQYZGZP__S_GZPZT,T_DQYZGZP.S_BPDD T_DQYZGZP__S_BPDD,T_DQYZGZP.S_JZ T_DQYZGZP__S_JZ,T_DQYZGZP.S_FZBM T_DQYZGZP__S_FZBM,T_DQYZGZP.S_GZFZR T_DQYZGZP__S_GZFZR,T_DQYZGZP.S_ZY T_DQYZGZP__S_ZY,T_DQYZGZP.S_BZRY T_DQYZGZP__S_BZRY,T_DQYZGZP.S_GZBZRY T_DQYZGZP__S_GZBZRY,T_DQYZGZP.S_RS T_DQYZGZP__S_RS,T_DQYZGZP.S_GZDDGZSB T_DQYZGZP__S_GZDDGZSB,T_DQYZGZP.S_GZNR T_DQYZGZP__S_GZNR,T_DQYZGZP.S_JHKSSJ T_DQYZGZP__S_JHKSSJ,T_DQYZGZP.S_JHJSSJ T_DQYZGZP__S_JHJSSJ,T_DQYZGZP.S_SFHYFP T_DQYZGZP__S_SFHYFP,T_DQYZGZP.S_SPJG T_DQYZGZP__S_SPJG,T_DQYZGZP.S_GZPQM T_DQYZGZP__S_GZPQM,T_DQYZGZP.S_GZPQFSJ T_DQYZGZP__S_GZPQFSJ,T_DQYZGZP.S_GLYQM T_DQYZGZP__S_GLYQM,T_DQYZGZP.S_GLYQMSJ T_DQYZGZP__S_GLYQMSJ,T_DQYZGZP.S_JSR T_DQYZGZP__S_JSR,T_DQYZGZP.S_JSSJ T_DQYZGZP__S_JSSJ,T_DQYZGZP.S_JZZQM T_DQYZGZP__S_JZZQM,T_DQYZGZP.S_JZZQMSJ T_DQYZGZP__S_JZZQMSJ,T_DQYZGZP.S_PZKSGZSJ T_DQYZGZP__S_PZKSGZSJ,T_DQYZGZP.S_PZJSGZSJ T_DQYZGZP__S_PZJSGZSJ,T_DQYZGZP.S_PZZZ T_DQYZGZP__S_PZZZ,T_DQYZGZP.S_XKKSGZSJ T_DQYZGZP__S_XKKSGZSJ,T_DQYZGZP.S_GZFZRQM T_DQYZGZP__S_GZFZRQM,T_DQYZGZP.S_GZXKRQM T_DQYZGZP__S_GZXKRQM,T_DQYZGZP.S_XMGLYQM T_DQYZGZP__S_XMGLYQM,T_DQYZGZP.S_XFZR T_DQYZGZP__S_XFZR,T_DQYZGZP.S_BGSJ T_DQYZGZP__S_BGSJ,T_DQYZGZP.S_BG_GZPQFR T_DQYZGZP__S_BG_GZPQFR,T_DQYZGZP.S_BG_GZXKR T_DQYZGZP__S_BG_GZXKR,T_DQYZGZP.S_YQ_XMGLYQM T_DQYZGZP__S_YQ_XMGLYQM,T_DQYZGZP.S_YQ_YQZ T_DQYZGZP__S_YQ_YQZ,T_DQYZGZP.S_YQ_XMGLYQMSJ T_DQYZGZP__S_YQ_XMGLYQMSJ,T_DQYZGZP.S_YQ_GZFZRQM T_DQYZGZP__S_YQ_GZFZRQM,T_DQYZGZP.S_YQ_GZFZRQMSJ T_DQYZGZP__S_YQ_GZFZRQMSJ,T_DQYZGZP.S_YQ_XKRHZZQM T_DQYZGZP__S_YQ_XKRHZZQM,T_DQYZGZP.S_YQ_XKRHZZQMSJ T_DQYZGZP__S_YQ_XKRHZZQMSJ,T_DQYZGZP.S_GZZJ_JXGZJD T_DQYZGZP__S_GZZJ_JXGZJD,T_DQYZGZP.S_GZZJ_GZZZSJ T_DQYZGZP__S_GZZJ_GZZZSJ,T_DQYZGZP.S_GZZJ_JDXBH T_DQYZGZP__S_GZZJ_JDXBH,T_DQYZGZP.S_GZZJ_ZS T_DQYZGZP__S_GZZJ_ZS,T_DQYZGZP.S_GZZJ_TS T_DQYZGZP__S_GZZJ_TS,T_DQYZGZP.S_GZZJ_GZFZRQM T_DQYZGZP__S_GZZJ_GZFZRQM,T_DQYZGZP.S_GZZJ_GZFZRQMSJ T_DQYZGZP__S_GZZJ_GZFZRQMSJ,T_DQYZGZP.S_GZZJ_GZXKRQM T_DQYZGZP__S_GZZJ_GZXKRQM,T_DQYZGZP.S_GZZJ_GZXKRQMSJ T_DQYZGZP__S_GZZJ_GZXKRQMSJ,T_DQYZGZP.S_DJZJ_DJZJSJ T_DQYZGZP__S_DJZJ_DJZJSJ,T_DQYZGZP.S_DJZJ_DJZJR T_DQYZGZP__S_DJZJ_DJZJR,T_DQYZGZP.S_DJZF_ZFR T_DQYZGZP__S_DJZF_ZFR,T_DQYZGZP.S_DJZF_DJZFSJ T_DQYZGZP__S_DJZF_DJZFSJ,T_DQYZGZP.S_BZ T_DQYZGZP__S_BZ,T_DQYZGZP.S_ZDR T_DQYZGZP__S_ZDR,T_DQYZGZP.S_ZDSJ T_DQYZGZP__S_ZDSJ,T_DQYZGZP.S_CJR T_DQYZGZP__S_CJR,T_DQYZGZP.S_CJSJ T_DQYZGZP__S_CJSJ,T_DQYZGZP.S_ZHXGR T_DQYZGZP__S_ZHXGR,T_DQYZGZP.S_ZHXGSJ T_DQYZGZP__S_ZHXGSJ,T_DQYZGZP.S_GZPBH T_DQYZGZP__S_GZPBH,T_DQYZGZP.SYS_FLOW_VER T_DQYZGZP__SYS_FLOW_VER,T_DQYZGZP.S_ID T_DQYZGZP__S_ID,T_DQYZGZP.S_RUN_ID T_DQYZGZP__S_RUN_ID,	\r\n \r\n  concat(\"<div name=\'S_RUN_AGR\'>\",T_DQYZGZP.S_ID,\",\",ifnull(T_SYS_flow_run.S_RUN_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_FLOW_ID,\'\'),\",\",T_DQYZGZP.SYS_FLOW_VER,\",\",ifnull( t_sys_flow_run.S_NODE_CODE,\'\'),\"</div>\") S_RUN_AGR,\r\nif(t_sys_flow_run.S_AUD_USER is null,\'\',replace(t_sys_flow_run.S_AUD_USER,\',\',\'`\')) S_AUD_USER,\r\nconcat(\"<div name=\'sys_I_isover\'>\",ifnull( t_sys_flow_run.I_ISOVER,\'\'),\"</div>\") I_ISOVER2\r\n', `SEDITPAGE`='View?SPAGECODE=1504686822663&sys_bed=true&bmid=<<T_DQYZGZP__S_ZZ>>&S_ID=<<T_DQYZGZP__S_ID>>&sid=<<T_DQYZGZP__S_ID>>&sys_no_copy=T_DQYZGZP$S_GZPZT,T_DQYZGZP$S_GZFZR_NAME,T_DQYZGZP$S_FZBM_NAME,T_DQYZGZP$S_JHKSSJ,T_DQYZGZP$S_JHJSSJ,T_DQYZGZP$S_GZPQM_NAME,T_DQYZGZP$S_GZPQFSJ,T_DQYZGZP$S_GLYQMSJ_NAME,T_DQYZGZP$S_GLYQMSJ,T_DQYZGZP$S_JSSJ,T_DQYZGZP$S_JSR,T_DQYZGZP$S_JSR_NAME,T_DQYZGZP$S_JZZQM_NAME,T_DQYZGZP$S_JZZQMSJ,T_DQYZGZP$S_PZKSGZSJ,T_DQYZGZP$S_PZJSGZSJ,T_DQYZGZP$S_PZZZ,T_DQYZGZP$S_PZZZ_NAME,T_DQYZGZP$S_XKKSGZSJ,T_DQYZGZP$S_GZFZRQM_NAME,T_DQYZGZP$S_GZXKRQM_NAME,T_DQYZGZP$S_XMGLYQM_NAME,T_DQYZGZP$S_XFZR_NAME,T_DQYZGZP$S_BGSJ,T_DQYZGZP$S_BG_GZPQFR_NAME,T_DQYZGZP$S_BG_GZPQFRSJ,T_DQYZGZP$S_BG_GZXKR_NAME,T_DQYZGZP$S_BG_GZXKRSJ,T_DQYZGZP$S_BG_BGXFZRW,T_DQYZGZP$S_YQ_YQZ,T_DQYZGZP$S_YQ_XMGLYQM_NAME,T_DQYZGZP$S_YQ_XMGLYQMSJ,T_DQYZGZP$S_YQ_GZFZRQM_NAME,T_DQYZGZP$S_YQ_GZFZRQMSJ,T_DQYZGZP$S_YQ_XKRHZZQM_NAME,T_DQYZGZP$S_YQ_XKRHZZQMSJ,T_DQYZGZP$S_YQ_ZZ,T_DQYZGZP$S_YQ_ZZSJ,T_DQYZGZP$S_GZZJ_JXGZJD,T_DQYZGZP$S_GZZJ_GZZZSJ,T_DQYZGZP$S_GZZJ_JDXBH,T_DQYZGZP$S_GZZJ_ZS,T_DQYZGZP$S_GZZJ_TS,T_DQYZGZP$S_GZZJ_GZFZRQM_NAME,T_DQYZGZP$S_GZZJ_GZFZRQM,T_DQYZGZP$S_GZZJ_GZFZRQMSJ,T_DQYZGZP$S_GZZJ_GZXKRQM_NAME,T_DQYZGZP$S_GZZJ_GZXKRQMSJ,T_DQYZGZP$S_GZZJ_XMGLY,T_DQYZGZP$S_DJZJ_DJZJR_NAME,T_DQYZGZP$S_DJZJ_DJZJSJ,T_DQYZGZP$S_DJZF_ZFR,T_DQYZGZP$S_DJZF_DJZFSJ,T_DQYZGZP$S_BZ,T_DQYZGZP$S_ZDSJ,T_DQYZGZP$S_ZDR_NAME,T_DQYZGZP$S_ZDR,T_DQYZGZP$S_GZPBH,T_DQYZGZP$S_ID,T_DQYZGZP$S_RUN_ID,T_DQYZGZP$SYS_FLOW_VER,DQYZGZP$S_SPJG', `SCONID`='1500262834776', `SMOD`='', `STRANS`='0,View_TS_GZPZT,0,0,View_TS_JZ,T_ZY,T_BZ ,1504854931447,T_RGXX,T_RGXX,0,1500877162713,0,0,0', `SUSERID`='sip', `SISSPLIT`='1:50', `SISLAYOUT`=NULL, `SSQLCON`='0,0,0,0,0,0,0,0,0,0,0,0,0,0,0', `SJUMPPAGE`=NULL, `SELEMENTTYPE`='005007017001', `STREE`='', `SJSSCRIPT`='//双击事件	\r\n/** yltPub.DBL_1500260362709=function(_objChilds,_iRowIndex){	\r\nminiWin(\'标题\',\'\',\'url\',parent.parent.parent.iScreen_Width-50,parent.parent.parent.iScreen_Height-50,\'\',\'\');	\r\n}\r\nvar bac=\'<<sys_bed>>\';\r\nif(bac!=\'true\'){\r\n    document.getElementById(\'T_DQYZGZP$S_JHKSSJ\').value=\"\";\r\n    document.getElementById(\'T_DQYZGZP$S_JHJSSJ\').value=\"\";\r\n    }\r\n**/	\r\n\r\n\r\n     \r\n     document.write(\"<script src=\'res/js/alertfField.js?v=\"+ Math.random()+\"\' charset=\\\"utf-8\\\"><\\/script>\"); \r\n</script>\r\n<style>\r\n    .td1_none{\r\n        display:none;\r\n    }\r\n    .td1end_none{\r\n        display:none;\r\n    }\r\n</style>\r\n\r\n<script>\r\nvar bmid=\"<<bmid>>\";\r\nsFlow_evet.init(\"1504686822663\", \"<<bmid>>\");  // 初始化流程运行方法\r\nsFlow_evet.processOver();  // 判断流程是否结束\r\n\r\nyltPub.DBL_1500260362709=function(_objChilds,_iRowIndex){	\r\n  var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n    objCheckChilds[_iRowIndex-1].checked=true;\r\n    sys_EditForm(2000,1800,\"detail\");\r\n\r\n};\r\n\r\nfunction xiugai(){\r\n    var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n	var strComponents=\"\";\r\n	var objTable=document.getElementById(\"tb\");\r\n		var iCheckCount=objCheckChilds.length;\r\n		var count =0;\r\n		for(var i=0;i<iCheckCount;i++){\r\n			if(objCheckChilds[i].checked){\r\n				strComponents=objTable.rows[parseInt(objCheckChilds[i].value)+1].cells[9].innerHTML;\r\n				count++;\r\n			}\r\n		}\r\n		if(strComponents==\"\"||count>1){\r\n		    alert(\"请选择一行数据\");\r\n		   \r\n		}else{\r\n		     miniWin(\'修改\',\'\',\'View?SPAGECODE=1500260373394&sys_bed=true&bmid=<<bmid>>&S_ID=\'+strComponents,2000,1000,\'\',\'\');\r\n		}\r\n}\r\n\r\n\r\nfunction deldata(){ //删除数据\r\n    strComponents = getDataId();\r\n    var arr =null;\r\n    if(strComponents ===false)return;\r\n        if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行删除!\");\r\n        return;\r\n    }else{\r\n        var strComponents = sys_getCurSelCheckBox()[0].value;\r\n        var createUser = tb.rows[parseInt(strComponents)+1].cells[10].innerHTML;\r\n	    arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n		var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n                \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n                var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n                var jdlx = subGetTx(returnUserBz,\"jdlx\");\r\n                //判断是否结束\r\n                if(LCSFYX==\"1\"){\r\n                    alert(\"流程结束,不可删除单据\");\r\n                    return false;\r\n                //判断流程是否启动\r\n                }else if(LCSFYX==\"0\"){\r\n                     //判读流程是否撤回\r\n                    if(jdlx!=\"3\"){\r\n                        alert(\"流程已启动,不可删除单据\");\r\n                        return false;\r\n                    }\r\n                }\r\n                //判读是否事管理员\r\n                if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n                    //判读是否是当前用户创建的单据\r\n                    if(createUser!=\"<<SYS_STRCURUSER>>\" && createUser!=\"<<SYS_STRCURUSERNAME>>\"){\r\n                        alert(\"此单据不是您创建的单据不可删除\");\r\n                        return false;\r\n                    }\r\n                }\r\n                \r\n               /* if (jdlx==\"3\"){\r\n                    \r\n                }else{\r\n                    if(LCSFYX==\"0\"){\r\n                        alert(\"此单据已经启动流程\");\r\n                        return false;\r\n                    }\r\n                }*/\r\n\r\n                // if(LCSFYX==\"0\"){\r\n                //     alert(\"此单据已经启动流程\");\r\n                //     return false;\r\n                // }\r\n                strComponents= \"\'\"+arr[0]+\"\'\";\r\n       \r\n    }\r\n	if(confirm(\"确定要删除所选数据吗?\")){\r\n    	getTx(\"comid=026&tablename=T_DQYZGZP&sid=\"+strComponents,\"docommand\");\r\n    	\r\n         getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n    \r\n    	window.location.reload();\r\n    }\r\n}\r\n\r\n \r\n                \r\nfunction voids(){ //作废数据\r\n    strComponents = getDataId();\r\n    if(strComponents ===false)return;\r\n    if(strComponents.split(\",\").length>1){\r\n        alert(\"只能选择一条进行作废!\");\r\n        return;\r\n    }\r\n  \r\n    if(confirm(\"确定要作废所选数据吗?\")){\r\n        var nowtime =getNowFormatDate();\r\n        var nowuser=\'<<SYS_STRCURUSER>>\';\r\n        getTx(\"comid=036&time=\"+nowtime+\"&user=\"+nowuser+\"&sid=\"+strComponents,\"docommand\");\r\n\r\n	    var arr = sFlow_evet.S_RUN_AGR[sys_getCurSelCheckBox()[0].value].innerHTML.split(\",\");\r\n\r\n        getTx(\"comid=092&S_FLOW_ID=\"+arr[2]+\"&S_RUN_ID=\"+arr[1],\"docommand\");\r\n       \r\n        \r\n        window.location.reload();\r\n    }\r\n}\r\n	\r\n	\r\n	\r\nfunction printdata(){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行打印！\");\r\n		else{\r\n			var str=$(\"sysdelvalue\"+arrCurSelRow[0].value).value;\r\n			str = str.substring(str.indexOf(\"$\")+1,str.length);\r\n			window.open(\"printdqyz.v?\"+str);\r\n		\r\n			}\r\n	else\r\n		alert(\"请选择一条打印项！\");\r\n\r\n}\r\n\r\n\r\n\r\n\r\nfunction insert(){\r\n    miniWin(\'电气一种工作票\',\'\',\"View?SPAGECODE=1504686822663&bmid=<<bmid>>&SSIZE=2000,2000\",2000,1400,\'\',\'\');\r\n		\r\n}\r\n\r\nfunction sys_EditForm(width,height,flag){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n    if(arrCurSelRow.length>0){\r\n		if(arrCurSelRow.length>1){\r\n			alert(\"最多只能选中一条记录进行修改！\");\r\n		}else{\r\n		    // 流程是否结束   ||   设置flag\r\n		    var strUrl=$(\"syseditvalue\" + arrCurSelRow[0].value).value+\"&bmid=<<bmid>>\";\r\n		    if(flag===\"detail\"&&(sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"1\"||sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"0\")){\r\n		        strUrl+=\"&doview=\" + flag;\r\n		    }\r\n			miniWin(\'修改信息\',\'\',strUrl,2000,1800,\'\',\'\');\r\n		}\r\n	}else{\r\n		alert(\"请选择一条修改项 \");\r\n	}\r\n}\r\nfunction sys_CopyForm(_iWidth,_iHeight){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行复制！\");\r\n		else{\r\n			var strUrl=$(\"syseditvalue\"+arrCurSelRow[0].value).value+\"&sys_copy=true\";\r\n			miniWin(\'复制信息\',\'\',strUrl,2000,2000,\'\',\'\');\r\n			}\r\n	else\r\n		alert(\"请选择一条复制项！\");\r\n  }\r\n\r\n', `SFORM`='', `SISCOLCHANGEROW`='', `STRSTYLE`='', `SDATADB`='', `SINVOKE`='', `S_JS`='' WHERE (`SPAGECODE`='1500260362709');
