UPDATE `sip`.`t_sys_pagemsg` SET `SPAGECODE`='1504086699116', `SFIELDCODE`='T_QXJL__S_QXBH,T_QXJL__S_JZ,T_QXJL__S_SSZY,T_QXJL__S_QXZT,$IFLINK<<SYS_STRCURUSER>>$IN:<<S_AUD_USER>>$<a name=\"SYS_SHPUT_SEL\" href=\"javascript:#;\" class=\"button blue\" onclick=\"sFlow_evet.audit(this);\"><span><div class=\'bttn_panel\'\r\nstyle=\'background-image:url(images/eve/edit.png);\'>审核</div></span></a>`<div name=\"SYS_SHPUT_SEL\">---</div>,T_QXJL__S_GZXXSM,T_QXJL__S_QXLB,T_QXJL__S_SGYSYJ,T_QXJL__S_CJR,T_QXJL__S_FXSJ,T_QXJL__S_CJSJ,T_QXJL__S_QRSJ,T_QXJL__S_SJJSSJ,T_QXJL__S_XQDW,S_ZZ,T_QXJL__S_SGYSSJ,T_QXJL__S_RUN_AGR,S_AUD_USER,I_ISOVER2,T_QXJL__S_QXZT,S_ZFYY', `SFIELDNAME`='缺陷编号,机组,专业,缺陷状态,处理,缺陷内容,缺陷类别,申请开口原因,发现人,发现时间,登记时间,确认时间,实际结束时间,消缺单位,组织,恢复开口时间,流程1,流程2,流程3,T_QXJL__S_QXZT,作废原因', `SFIELDSIZE`='150,60,70,100,200,600,70,120,70,120,120,120,120,0,0,0,0,0,0,0,120', `SQUERYFIELD`='1,T_QXJL.S_GZXXSM:0:缺陷内容:0:LIKE,T_QXJL.S_SSZY:152369940254212956:缺陷专业:0:LIKE', `SGLFIELD`='SYSCLASS:button red:add.png|1504084562001&BZTYPE=JXBZ&tab=QXJL&bmid=<<sys_dqyhzz>>&type=1&flag=true$缺陷,SYSCLASS:button red:add.png|SYSCLICK:printdata();$打印,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditLog();$审批日志,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.auditProComp();$流程图,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.ancelProcess();$撤回,SYSCLASS:button red:add.png|SYSCLICK:sFlow_evet.screening(\'<<SYS_STRCURUSER>>\');$筛选审核,SYSCLASS:button red:add.png|TOEXCEL1504086699116&dawh_type=QXZT&bmid=<<bmid>>&sys_dqyhzz=<<sys_dqyhzz>>&del=0$导出$A', `SPAGENAME`='缺陷记录', `SPAGETYPE`='1', `SQERYCON`='T_QXJL.S_ZZ=\'<<sys_dqyhzz>>\'\r\n order by t_order_set.i_order desc,T_QXJL.S_ID desc', `SDELCON`='T_QXJL$S_ID=<<S_ID>>', `SHREFIELD`=NULL, `SQUERYTABLE`='T_QXJL left join  t_sys_flow_run on T_QXJL.S_RUN_ID= t_sys_flow_run.S_RUN_ID LEFT OUTER JOIN t_order_set on T_QXJL.S_QXZT=t_order_set.S_OBJECT_ID and t_order_set.I_TYPE=1\r\n', `SSIZE`='2000,1800:0,0:0,0:0,0:0,0:0,0:0,0:0,0:0,0', `SQLFIELD`='	\r\n    T_QXJL.S_QXBH T_QXJL__S_QXBH,\r\n    T_QXJL.S_QXZT T_QXJL__S_QXZT,\r\n    T_QXJL.S_ID,\r\n    T_QXJL.S_GZXXSM T_QXJL__S_GZXXSM,\r\n    T_QXJL.S_FXSJ T_QXJL__S_FXSJ,\r\n    T_QXJL.S_QRSJ T_QXJL__S_QRSJ,\r\n    T_QXJL.S_XQDW T_QXJL__S_XQDW,\r\n    T_QXJL.S_JZ T_QXJL__S_JZ,\r\n    T_QXJL.S_SBMC,\r\n    T_QXJL.S_QXLB T_QXJL__S_QXLB,\r\n    T_QXJL.S_SBZRR,\r\n    T_QXJL.S_SSZY T_QXJL__S_SSZY,\r\n    T_QXJL.S_FXRSSBZ,\r\n    T_QXJL.S_GZPPZ,\r\n    T_QXJL.S_FXRSSBM_NAME,\r\n    T_QXJL.S_CJR T_QXJL__S_CJR,\r\n    T_QXJL.S_CJSJ T_QXJL__S_CJSJ,\r\n    T_QXJL.S_ZZ,\r\n    T_QXJL.S_SJJSSJ T_QXJL__S_SJJSSJ,\r\n    T_QXJL.S_SGYSSJ T_QXJL__S_SGYSSJ,\r\n    T_QXJL.S_SGYSYJ T_QXJL__S_SGYSYJ,\r\n    T_QXJL.S_ZFYY,\r\n    T_QXJL.S_WHZFPSR,\r\n    T_QXJL.S_WHZFPSSJ,\r\n    T_QXJL.S_SJZFPSR,\r\n    T_QXJL.S_SJZFPSSJ,\r\n    concat(\"<div name=\'S_RUN_AGR\'>\",T_QXJL.S_ID,\",\",ifnull(T_SYS_flow_run.S_RUN_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_FLOW_ID,\'\'),\",\",ifnull(t_sys_flow_run.S_AUDIT_VERSION,\'\'),\",\",ifnull( t_sys_flow_run.S_NODE_CODE,\'\'),\"</div>\") T_QXJL__S_RUN_AGR,\r\n if(t_sys_flow_run.S_AUD_USER is null,\'\',replace(t_sys_flow_run.S_AUD_USER,\',\',\'`\')) S_AUD_USER,\r\n concat(\"<div name=\'sys_I_isover\'>\",ifnull( t_sys_flow_run.I_ISOVER,\'\'),\"</div>\") I_ISOVER2\r\n \r\n', `SEDITPAGE`='View?SPAGECODE=1504084562001&sys_bed=true&S_ID=<<S_ID>>&bmid=<<S_ZZ>>&BZTYPE=JXBZ&sys_no_copy=T_QXJL$S_QXBH,T_QXJL$S_RUN_ID,T_QXJL$S_XQDW,T_QXJL$S_QRR,T_QXJL$S_QRSJ,T_QXJL$S_SJJSSJ,T_QXJL$S_GZPPZ,T_QXJL$S_GZFZR,T_QXJL$S_WWGSJTFZR,T_QXJL$S_SJKSSJ,T_QXJL$S_SJJSSJ,T_QXJL$S_CLQK,T_QXJL$S_YXYSRBM,T_QXJL$S_YXYSSJ,T_QXJL$S_YXYSYJ,T_QXJL$S_SGYSYJ,T_QXJL$S_SGYSR,T_QXJL$S_SGYSSJ,T_QXJL$S_YXYSR,T_QXJL$S_CJR,T_QXJL$S_CJSJ,T_QXJL$S_ZDR,T_QXJL$S_FXR,T_QXJL$S_FXRBM,T_QXJL$S_FXSJ,T_QXJL$S_FXRSSBM_NAME,T_QXJL$S_FXRSSBM,T_QXJL$S_FXRSSBZ,T_QXJL$S_ZDSJ', `SCONID`='1504086711190', `SMOD`='', `STRANS`='0,View_TS_JZ,T_ZY,View_TS_QXZT,0,0,T_QXLX,0,0,0,0,0,0,T_BZ,0,0,0,0,0,0,0', `SUSERID`='sip', `SISSPLIT`='1:50', `SISLAYOUT`=NULL, `SSQLCON`='0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0', `SJUMPPAGE`=NULL, `SELEMENTTYPE`='005006', `STREE`='', `SJSSCRIPT`='/*\r\n2018-02-24 10:56:36 Mantra\r\n*/\r\ndocument.write(\"<script src=\'res/js/alertfField.js?v=\"+ Math.random()+\"\' charset=\\\"utf-8\\\"><\\/script>\");\r\n</script>\r\n<style>\r\n    .td1_none{\r\n        display:none;\r\n    }\r\n    .td1end_none{\r\n        display:none;\r\n    }\r\n</style>\r\n<script>\r\n\r\nvar tableEle = $I(\'tb\');\r\nrows = tableEle.getElementsByTagName(\"tr\");\r\nvar seperator1 = \"/\"; \r\nvar seperator2 = \":\";\r\n\r\n\r\nfor(var i = 1; i < rows.length; i++) {\r\n    //缺陷状态\r\n    var qxzt = rows[i].cells[20].innerHTML.trim();\r\n    //作废状态\r\n    if (\'QXZT013\' == qxzt) {\r\n        rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/error.png\" height=\"18\" width=\"18\"  />\';\r\n    }\r\n    \r\n    //缺陷挂起\r\n    if (\'QXZT030\' == qxzt ||\r\n        \'QXZT031\' == qxzt ||\r\n        \'QXZT032\' == qxzt ||\r\n        \'QXZT033\' == qxzt) {\r\n        rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/suspend.png\" height=\"18\" width=\"18\"  />\';\r\n    }\r\n\r\n    var fx = rows[i].cells[10].innerHTML; //发现时间 S_FXSJ\r\n    var d1 = new Date(fx);\r\n    var year = d1.getFullYear();\r\n    var month = d1.getMonth() + 1;\r\n    var strDate = d1.getDate();\r\n    var hour =d1.getHours();\r\n    var minu=d1.getMinutes();\r\n    var second=d1.getSeconds();\r\n    if (hour >= 0 && hour <= 9) {\r\n                hour = \"0\" + hour;\r\n            }\r\n    if (second >= 0 && second <= 9) {\r\n                second = \"0\" + second;\r\n            }\r\n    var bd = year + seperator1 + month + seperator1 + strDate + \" \" + \"08\" + seperator2 + \"30\" + seperator2 + \"00\";\r\n    var jd = year + seperator1 + month + seperator1 + strDate + \" \" + \"10\" + seperator2 + \"00\" + seperator2 + \"00\"; //第二天早上确认时间\r\n    var sd = year + seperator1 + month + seperator1 + strDate + \" \" + \"17\" + seperator2 + \"00\" + seperator2 + \"00\";\r\n    var bd1 = new Date(bd);\r\n    var jd1 = new Date(jd);\r\n    var sd1 = new Date(sd);\r\n    var zao = d1-bd1;\r\n    var wan = d1-sd1;\r\n    var jzsj = new Date(\"2018/11/27 00:00:00\");\r\n    var jzc = d1-jzsj;\r\n    if(jzc >0){\r\n        if(zao >= 0 && wan <= 0 ){\r\n            var qr = rows[i].cells[12].innerHTML; //确认时间 S_QRSJ\r\n            if(qr != \'\' && qr != null){\r\n                var d2 = new Date(qr);\r\n                var gap = Math.abs(d1-d2)/1000/60/60;\r\n                if(gap >4){\r\n                    if(\'QXZT013\' != qxzt){\r\n                        rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        //rows[i].cells[1].style.color =\"yellow\";\r\n                    }\r\n                }\r\n            }else{\r\n                var date = new Date();\r\n                var gap = Math.abs(d1-date)/1000/60/60;\r\n                if(gap >4){\r\n                    if(\'QXZT013\' != qxzt){\r\n                        rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            var qr = rows[i].cells[12].innerHTML;\r\n            if(qr != \'\' && qr != null){\r\n                var d2 = new Date(qr);\r\n                /*if(hour >= 22 && minu >0){\r\n                    var nextday = new Date((d1/1000+86400)*1000);\r\n                    var year1 = nextday.getFullYear();\r\n                    var month1 = nextday.getMonth() + 1;\r\n                    var strDate1 = nextday.getDate();\r\n                    var jd11 = year1 + seperator1 + month1 + seperator1 + strDate1 + \" \" + \"10\" + seperator2 + \"00\" + seperator2 + \"00\";\r\n                    var jd12 = new Date(jd11);\r\n                    var jc = jd12-d2;\r\n                    if(jc <0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                             rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                    }\r\n                }else{\r\n                    var jc =jd1-d2;\r\n                    if(jc <0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                            rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                    }\r\n                }*/\r\n                if(hour > 0 && hour < 8){\r\n                    if(d2 - jd1 > 0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                             rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                        //rows[i].cells[1].style.color =\"yellow\";\r\n                    }\r\n                }else{\r\n                    jd1.setTime(jd1.getTime()+24*60*60*1000);\r\n                    if(d2 - jd1 > 0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                             rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                        //rows[i].cells[1].style.color =\"yellow\";\r\n                    } \r\n                }\r\n               \r\n            }else{\r\n                /*if(hour >= 22 && minu >0){\r\n                    var nextday = new Date((d1/1000+86400)*1000);\r\n                    var year1 = nextday.getFullYear();\r\n                    var month1 = nextday.getMonth() + 1;\r\n                    var strDate1 = nextday.getDate();\r\n                    var jd11 = year1 + seperator1 + month1 + seperator1 + strDate1 + \" \" + \"10\" + seperator2 + \"00\" + seperator2 + \"00\";\r\n                    var jd12 = new Date(jd11);\r\n                    var date = new Date();\r\n                    var gap = date-jd12\r\n                    if(gap >0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                            rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                    }\r\n                }else{\r\n                    var date = new Date();\r\n                    var gap =date-jd1;\r\n                    if(gap >0){\r\n                        if(\'QXZT013\' != qxzt){\r\n                            rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                        }\r\n                    }\r\n                }*/\r\n                var gap =date-jd1;\r\n                if(gap >0){\r\n                    if(\'QXZT013\' != qxzt){\r\n                        rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/waring.png\" height=\"18\" width=\"18\"  />\';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nfor(var i = 1; i < rows.length; i++) {\r\n    //缺陷状态\r\n    var qxzt = rows[i].cells[20].innerHTML.trim();\r\n    var sp = rows[i].cells[16].innerHTML; //恢复开口时间（审批时间） S_SGYSSJ\r\n    var fx = rows[i].cells[10].innerHTML; //发现时间 S_FXSJ\r\n    var qx = rows[i].cells[7].innerHTML; //缺陷类别 S_QXLB\r\n    var sjjs = rows[i].cells[13].innerHTML; //实际结束时间 S_SJJSSJ\r\n    var sjjs1 = new Date(sjjs);\r\n    var year = d1.getFullYear();\r\n    var month = d1.getMonth() + 1;\r\n    var strDate = d1.getDate();\r\n    var hour =d1.getHours();\r\n    var minu=d1.getMinutes();\r\n    var second=d1.getSeconds();\r\n\r\n    if (hour >= 0 && hour <= 9) {\r\n                hour = \"0\" + hour;\r\n            }\r\n    if (second >= 0 && second <= 9) {\r\n                second = \"0\" + second;\r\n            }\r\n    var sp1 = new Date(sp);\r\n    var d1 = new Date(fx);\r\n    var jzsj = new Date(\"2018/11/27 00:00:00\");\r\n    var jzc = d1-jzsj;\r\n    if(jzc >0){\r\n    if(sp != \'\' && sp != null){\r\n        var gap = Math.abs(sjjs1-sp1)/1000/60/60;\r\n            if(gap >48){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n    }else{\r\n    \r\n    if(qx == \'零类缺陷\'){\r\n        if(sjjs != \'\' && sjjs != null){\r\n            var gap = Math.abs(sjjs1-d1)/1000/60/60;\r\n            if(gap >24){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }else{\r\n            var date = new Date();\r\n            var gap = Math.abs(date-d1)/1000/60/60;\r\n            if(gap >24){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }\r\n    }else if(qx == \'一类缺陷\'){\r\n        if(sjjs != \'\' && sjjs != null){\r\n            var gap = Math.abs(sjjs1-d1)/1000/60/60;\r\n            if(gap >12){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                     rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }else{\r\n            var date = new Date();\r\n            var gap = Math.abs(date-d1)/1000/60/60;\r\n            if(gap >12){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }\r\n    }else if(qx == \'二类缺陷\'){\r\n        if(sjjs != \'\' && sjjs != null){\r\n            var gap = Math.abs(sjjs1-d1)/1000/60/60;\r\n            if(gap >24){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }else{\r\n            var date = new Date();\r\n            var gap = Math.abs(date-d1)/1000/60/60;\r\n            if(gap >24){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }\r\n    }else if(qx == \'三类缺陷\'){\r\n        if(sjjs != \'\' && sjjs != null){\r\n            var gap = Math.abs(sjjs1-d1)/1000/60/60;\r\n            if(gap >48){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }else{\r\n            var date = new Date();\r\n            var gap = Math.abs(date-d1)/1000/60/60;\r\n            if(gap >48){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }\r\n    }else if(qx == \'四类缺陷\'){\r\n        if(sjjs != \'\' && sjjs != null){\r\n            var gap = Math.abs(sjjs1-d1)/1000/60/60;\r\n            if(gap >72){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }else{\r\n            var date = new Date();\r\n            var gap = Math.abs(date-d1)/1000/60/60;\r\n            if(gap >72){\r\n                if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                    rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n    }\r\n}\r\n\r\n\r\nfor(var i=1;i < rows.length; i++){\r\n    console.log(\"111\");\r\n     //缺陷状态\r\n    var qxzt = rows[i].cells[20].innerHTML.trim();\r\n    var sjjs = rows[i].cells[13].innerHTML; //实际结束时间 S_SJJSSJ\r\n    var sp = rows[i].cells[16].innerHTML; //恢复开口时间（审批时间） S_SGYSSJ\r\n    var fx = rows[i].cells[10].innerHTML; //发现时间 S_FXSJ\r\n    var sp1 = new Date(sp);\r\n    var sjjs1 = new Date(sjjs);\r\n    var d1 = new Date(fx);\r\n    if(sp != \'\' && sp != null){\r\n        var gap = Math.abs(sjjs1-sp1)/1000/60/60;\r\n        if(gap >48){\r\n            if(\'QXZT013\' != qxzt && \'QXZT030\' != qxzt && \'QXZT031\' != qxzt && \'QXZT032\' != qxzt && \'QXZT033\' != qxzt){\r\n                rows[i].cells[1].innerHTML =rows[i].cells[1].innerHTML+\'  \'+\'<img src=\"res/images/redwarn.png\" height=\"18\" width=\"18\"  />\';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nfor(var i = 1; i < rows.length; i++) {\r\n    var cs = rows[i].cells[1].innerHTML;\r\n    str = cs.replace(/  /g, \",\");\r\n    var ret = [];\r\n    str.replace(/[^,]+/g, function($1, $2){\r\n        (str.indexOf($1) == $2) && ret.push($1);\r\n    });\r\n    rows[i].cells[1].innerHTML=ret;\r\n    \r\n    var zxc = rows[i].cells[1].innerHTML;\r\n    fishion = zxc.replace(/,/g, \" \");\r\n    rows[i].cells[1].innerHTML=fishion;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nsFlow_evet.init(\"1504084562001\", \"<<sys_dqyhzz>>\");  // 初始化流程运行方法\r\nsFlow_evet.processOver();  // 判断流程是否结束\r\n\r\nvar bmid=\"<<sys_dqyhzz>>\";\r\n\r\nyltPub.DBL_1504086699116=function(_objChilds,_iRowIndex){\r\n   var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n    objCheckChilds[_iRowIndex-1].checked=true;\r\n    sys_EditForm(2000,1800,\"detail\");\r\n}\r\n\r\nfunction sys_EditForm(width,height,flag){\r\n    var arrCurSelRow=sys_getCurSelCheckBox();\r\n    if(arrCurSelRow.length>0){\r\n		if(arrCurSelRow.length>1){\r\n			alert(\"最多只能选中一条记录进行修改！\");\r\n		}else{\r\n		    // 流程是否结束   ||   设置flag\r\n		    var strUrl=$(\"syseditvalue\" + arrCurSelRow[0].value).value+\"&bmid=<<bmid>>\";\r\n		    if(flag===\"detail\"&&(sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"1\"||sFlow_evet.SYS_I_ISOVER[arrCurSelRow[0].value].innerHTML===\"0\")){\r\n		        strUrl+=\"&doview=\" + flag;\r\n		    }\r\n			miniWin(\'修改信息\',\'\',strUrl,2000,1800,\'\',\'\');\r\n		}\r\n	}else{\r\n		alert(\"请选择一条修改项 \");\r\n	}\r\n}\r\n\r\nfunction insert(){\r\n    miniWin(\'选择\',\'\',\"View?SPAGECODE=1504084562001&tab=QXJL&bmid=<<sys_dqyhzz>>&type=1\",2000,1400,\'\',\'\');\r\n		\r\n}\r\n\r\nfunction dele(id){\r\n    doCommand(\'comid=1504086699116&T_QXJL.S_ID=\'+id+\'&T_QXJL.S_SFSC=1\');\r\n}\r\nfunction sbkp(sbbm){\r\n    // return false;\r\n   /* http://www.6xy8.com/sip/View?SPAGECODE=1505306641247&sys_bed=true&bmid=001017&S_ID=1510572235416&stype=1&sys_no_copy=T_SBKPZL$S_SBBM&gs_upl_kc=win0*/\r\n   \r\n \r\n//     var returnUserBz=getTx(\"S_SBBM=\"+sbbm,\"ajax.v\");\r\n//   var S_ID = subGetTx(returnUserBz,\"S_SBBM\");\r\n   \r\n//     miniWin(\'查看\',\'\',\"View?SPAGECODE=1505306641247&bmid=<<sys_dqyhzz>>&type=1&NO_VIEW_FLOW_BTTN=yes&NO_QXBTTN=no&NO_QDBTTN=no&sys_bed=true&S_ID=\"+S_ID,2000,1400,\'\',\'\');\r\n}\r\n\r\nfunction printdata(){\r\n      var arrCurSelRow=sys_getCurSelCheckBox();\r\n	if(arrCurSelRow.length>0)\r\n		if(arrCurSelRow.length>1)\r\n			alert(\"最多只能选中一条记录进行打印！\");\r\n		else{\r\n			var str=$(\"sysdelvalue\"+arrCurSelRow[0].value).value;\r\n			str = str.substring(str.indexOf(\"$\")+1,str.length);\r\n			window.open(\"/sip/qxdy.v?\"+str);\r\n		/*	window.open(\"/View?SPAGECODE=1508040933892&S_ID=1508043183201\");\r\n			miniWin(\'修改信息\',\'\',\"View?SPAGECODE=1507889168316&S_ID=\"+strUrl,\"800\",\"800\",\'\',\'\');*/\r\n			}\r\n	else\r\n		alert(\"请选择一条打印项！\");\r\n\r\n}\r\n\r\n// function delSysAll(){\r\n//     var arrCurSelRow=sys_getCurSelCheckBox();\r\n//     if(arrCurSelRow.length>0){\r\n// 		if(arrCurSelRow.length>1){\r\n// 			alert(\"最多只能选中一条记录进行删除！\");\r\n// 		}else{\r\n// 		    var strComponents = arrCurSelRow[0].value;\r\n// 		    var arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n//		     \r\n//                 var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n//                 \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n//                 var CJR = subGetTx(returnUserBz,\"QX_CJR\");\r\n//                 var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n//  \r\n//                 var processIndex = subGetTx(returnUserBz,\"processIndex\");\r\n//                 if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n//                 \r\n//                     if(CJR!=\"<<SYS_STRCURUSER>>\"){\r\n//                         alert(\"此单据不是您创建的单据\");\r\n//                        return false;\r\n//                     }\r\n//                    \r\n//                     if(processIndex!=\"0\"&&LCSFYX==\"0\"){\r\n//                         alert(\"此单据已经启动流程\");\r\n//                         return false;\r\n//                     }\r\n//                 }\r\n//                \r\n//                \r\n//                 if(confirm(\"确定要删除所选数据吗？\")){\r\n//                     strDelParam=$(\"sysdelvalue\"+strComponents).value;\r\n//                     getTx(strDelParam,\"YLDel\");\r\n//                     try{\r\n//         			    console.log(arr);\r\n//         			    getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n//     				}catch(e){\r\n//     				    console.log(\"err:015->delSysAll\");\r\n//     				}\r\n//                 }\r\n//                 if(strDelParam.indexOf(\"NO_flush=true\")!=-1)\r\n//         		parent.lxleft.yltTree.prototype.fushTree(\'testtree0\');\r\n//         		location.reload();\r\n// 		}\r\n// 	}else{\r\n// 		alert(\"请选择一条删除项 \");\r\n// 	}\r\n// }\r\n\r\nfunction delSysAll(){\r\n      var arrCurSelRow=sys_getCurSelCheckBox();\r\n      if(arrCurSelRow.length>0){\r\n          if(arrCurSelRow.length>1){\r\n              alert(\"最多只能选中一条记录进行删除！\");\r\n          }else{\r\n            var strComponents = arrCurSelRow[0].value;\r\n            // var createUser = tb.rows[parseInt(strComponents)+1].cells[10].innerHTML;\r\n            var arr = sFlow_evet.S_RUN_AGR[strComponents].innerHTML.split(\",\");\r\n            var returnUserBz=getTx(\'s_id=\' + arr[0] + \'&sys_flow_run_id=\' + arr[1] + \'&s_flow_id=\' + arr[2] +\r\n              \'&flow_ver=\' + arr[3],\"ajax.v\");\r\n            var CJR = subGetTx(returnUserBz,\"QX_CJR\");\r\n            var LCSFYX = subGetTx(returnUserBz,\"LCSFYX\");\r\n            var jdlx = subGetTx(returnUserBz,\"jdlx\");\r\n            console.log(CJR);\r\n            console.log(LCSFYX);\r\n            console.log(jdlx);\r\n            var processIndex = subGetTx(returnUserBz,\"processIndex\");\r\n            console.log(processIndex);\r\n    		//判断是否结束\r\n            if(LCSFYX==\"1\"){\r\n                alert(\"流程结束,不可删除单据\");\r\n                return false;\r\n            //判断流程是否启动\r\n            }else if(LCSFYX==\"0\"){\r\n                //判读流程是否撤回\r\n                if(jdlx!=\"3\"){\r\n                    alert(\"流程已启动,不可删除单据\");\r\n                    return false;\r\n                }\r\n            }\r\n            //判读是否事管理员\r\n            if(\"<<SYS_STRCURUSER>>\"!=\"888\"){\r\n                //判读是否是当前用户创建的单据\r\n                if(CJR!=\"<<SYS_STRCURUSER>>\" && CJR!=\"<<SYS_STRCURUSERNAME>>\"){\r\n                    alert(\"此单据不是您创建的单据不可删除\");\r\n                    return false;\r\n                }\r\n            }\r\n    		var message = \"确定要删除所选数据吗？\";\r\n                if(processIndex==\"\"){\r\n                message=\"此单据未启动流程,\"+message;\r\n            }\r\n              if(confirm(message)){\r\n                    var strDelParam=\"\";\r\n            		strDelParam=$(\"sysdelvalue\"+strComponents).value;\r\n            		getTx(strDelParam,\"YLDel\");\r\n            		try{\r\n            			getTx(\"S_ID=\"+arr[0]+\"&S_RUN_ID=\"+arr[1]+\"&S_FLOW_ID=\"+arr[2]+\"&S_AUTO_VER=\"+arr[3],\"process_fun.v\");\r\n            		}catch(e){\r\n            			console.log(\"err:015->delSysAll\");\r\n            		}\r\n            		if(strDelParam.indexOf(\"NO_flush=true\")!=-1)\r\n            			parent.lxleft.yltTree.prototype.fushTree(\'testtree0\');\r\n            		location.reload();\r\n              }\r\n          }\r\n      }else{\r\n          alert(\"请选择一条删除项 \");\r\n      }\r\n}\r\n\r\n\r\n// 	if(confirm(\"确定要删除所选数据吗？\")){\r\n// 	var objCheckChilds=document.getElementsByName(\"syscheckbox\");\r\n// 	var strDelParam=\"\";\r\n// 		var iCheckCount=objCheckChilds.length;\r\n// 		for(var i=0;i<iCheckCount;i++){\r\n// 			if(objCheckChilds[i].checked){\r\n// 				strDelParam=$(\"sysdelvalue\"+objCheckChilds[i].value).value;\r\n// 				getTx(strDelParam,\"YLDel\");\r\n// 			}\r\n// 		}\r\n// 		if(strDelParam.indexOf(\"NO_flush=true\")!=-1)\r\n// 			parent.lxleft.yltTree.prototype.fushTree(\'testtree0\');\r\n// 		location.reload();\r\n// 	}\r\n       function jstabletoexcel() {  \r\n  \r\n            var curTbl = document.getElementById(\"tbtitle\");  \r\n            var oXL = new ActiveXObject(\"Excel.Application\");  \r\n            var oWB = oXL.Workbooks.Add();  \r\n            var oSheet = oWB.ActiveSheet;  \r\n            var sel = document.body.createTextRange();  \r\n            sel.moveToElementText(curTbl);  \r\n            sel.select();  \r\n            sel.execCommand(\"Copy\");  \r\n            oSheet.Paste();  \r\n            oXL.Visible = true;  \r\n  \r\n        }\r\n\r\n\r\n', `SFORM`='', `SISCOLCHANGEROW`='', `STRSTYLE`='', `SDATADB`='', `SINVOKE`='', `S_JS`='' WHERE (`SPAGECODE`='1504086699116');
